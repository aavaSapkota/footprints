{% extends 'base.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/results.css' %}">
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
{% endblock %}

{% block title %}GreenTrack | Results {% endblock %}
{% block body %}
<article id="about-results">
    <h1>About Your Results</h1>
    <section class="info">
        {% for i in about %}
        <div>
            <h3>{{ i.title }}</h3>
            <p> {{ i.description }}</p>
        </div>
        {% endfor %}
    </section>
    <span class="arrow" id="about-toggle"><i class="fas fa-angle-double-down"></i></span>
</article>

<section id="summary">
    <h1>Total CO<sub>2</sub> released</h1>
    <div class="info">
        <span class="big-number">{{ emissions }}</span>
        <div class="unit">
            <span>kg of CO<sub>2</sub></span>
            <span></span>
        </div>
    </div>
</section>
<section id="source">
    <!-- todo: future - on click, modal of receipt (enlargen) -->
    <img src="{{ purchase.receipt.url }}" alt="Receipt">
    <div class="info">
        <div>
            <p>{{ local_percent }}% Locally Sourced</p>
            <div class="meter" style="width: {{ local_ratio }}%"></div>
        </div>
        <div>
            <p>{{ global_percent }}% Globally Sourced</p>
            <div class="meter" style="width: {{ global_ratio }}%"></div>
        </div>
    </div>
</section>
<section id="breakdown">
    <table>
        <thead>
            <tr>
                <th>Item</th>
                <!-- <th>Quantity (kg)</th> -->
                <th>Source</th>
                <th>Footprint <br> (kgCOâ‚‚eq)</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td>{{ item.item | title }}</td>
                <td>
                    {% if item.local %}
                    Local
                    {% else %}
                    Global
                    {% endif %}
                </td>
                <!-- <td>{{ item.quantity }}</td> -->
                <td>{{ item.emissions }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>

<section id="save">
    <a href="#" class="btn-white"><span>Save Receipt</span></a>
</section>

<script>
    $(document).ready(() => {
            $("#about-toggle").click(function() {
                    if ($("#about-results").hasClass("expanded")) {
                            $("#about-results").removeClass("expanded");
                            $("#about-results > section.info").slideUp()
                        } else {
                                $("#about-results").addClass("expanded");
                                $("#about-results > section.info").slideDown()
                            }
                });
        })
</script>

<hr>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    google.charts.load('current', {
            'packages': ['corechart']
        });
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Emissions Type');
            data.addColumn('number', 'Amount');
            data.addRows([{
                    %
                    if emissions_land >= 0 %
                }
                    ['Land Use Emissions', {
                            {
                                    emissions_land
                                }
                        }],
                    {
                            % endif %
                        } {
                                %
                                    if emissions_farm >= 0 %
                            }
                    ['Farm Emissions', {
                            {
                                    emissions_farm
                                }
                        }],
                    {
                            % endif %
                        } {
                                %
                                    if emissions_feed >= 0 %
                            }
                    ['Animal Feed Emissions', {
                            {
                                    emissions_feed
                                }
                        }],
                    {
                            % endif %
                        } {
                                %
                                    if emissions_processing >= 0 %
                            }
                    ['Processing Emissions', {
                            {
                                    emissions_processing
                                }
                        }],
                    {
                            % endif %
                        } {
                                %
                                    if emissions_transport >= 0 %
                            }
                    ['Transport Emissions', {
                            {
                                    emissions_transport
                                }
                        }],
                    {
                            % endif %
                        } {
                                %
                                    if emissions_retail >= 0 %
                            }
                    ['Retail Emissions', {
                            {
                                    emissions_retail
                                }
                        }],
                    {
                            % endif %
                        } {
                                %
                                    if emissions_packaging >= 0 %
                            }
                    ['Packaging Emissions', {
                            {
                                    emissions_packaging
                                }
                        }] {
                                % endif %
                            }
                ])
            var options = {
                    'title': 'Emissions by Category',
                    'width': 500,
                    'height': 400
                }
            var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
            chart.draw(data, options);
        }
</script>

<div id="chart_div"></div>
{% endblock %}
